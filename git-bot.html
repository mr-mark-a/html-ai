<!DOCTYPE html>
<html lang="en">
<head>
  <title>Gitbot</title>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Chat-Only with Image Replies</title>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: sans-serif;
      background: #121212;
      color: #e0e0e0;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }
    .chat-container {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
    }
    .input-container {
      display: flex;
      padding: 10px;
      background: #1f1f1f;
    }
    .input-container input {
      flex: 1;
      padding: 10px;
      font-size: 1rem;
      border: none;
      border-radius: 4px;
      margin-right: 8px;
      background: #2e2e2e;
      color: #e0e0e0;
    }
    .input-container button {
      padding: 10px 16px;
      font-size: 1rem;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      background: #2979ff;
      color: white;
      margin-right: 8px;
    }
    .input-container .voice-btn {
      background: #4caf50;
    }
    .settings-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }
    .settings-content {
      background: #2e2e2e;
      padding: 20px;
      border-radius: 8px;
      max-width: 400px;
      width: 90%;
      color: #e0e0e0;
    }
    .settings-content h3 {
      margin-top: 0;
    }
    .settings-content select {
      width: 100%;
      padding: 8px;
      margin-bottom: 10px;
      background: #1f1f1f;
      color: #e0e0e0;
      border: 1px solid #444;
      border-radius: 4px;
    }
    .settings-content button {
      padding: 8px 16px;
      margin-right: 8px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      background: #2979ff;
      color: white;
    }
    .message {
      margin-bottom: 16px;
      line-height: 1.4;
    }
    .message.user {
      text-align: right;
    }
    .message.user .bubble {
      display: inline-block;
      background: #2979ff;
      color: white;
      padding: 10px 14px;
      border-radius: 16px 16px 0 16px;
    }
    .message.bot .bubble {
      display: inline-block;
      background: #2e2e2e;
      padding: 10px 14px;
      border-radius: 16px 16px 16px 0;
    }
    .message.bot img {
      display: block;
      margin-top: 8px;
      max-width: 70%;
      border-radius: 8px;
      border: 1px solid #444;
    }
  </style>
</head>
<body>


  <!-- Exit Button -->
  <button id="exitBtn" onclick="exitChat()" style="position: fixed; top: 20px; right: 20px; background: #dc3545; color: white; border: none; border-radius: 6px; padding: 8px 16px; cursor: pointer; font-size: 14px;">‚ùå Exit</button>

  <!-- Settings Button -->
  <button id="settingsBtn" onclick="openSettings()" style="position: fixed; top: 20px; right: 80px; background: #666; color: white; border: none; border-radius: 6px; padding: 8px 16px; cursor: pointer; font-size: 14px;">‚öôÔ∏è Settings</button>

  <div id="chat" style="display:flex; flex:1; flex-direction:column; height:100vh;">
    <div class="chat-container" id="chatContainer"></div>
    <div class="input-container">
      <input type="text" id="prompt" placeholder="Ask me something‚Ä¶"/>
      <button id="micBtn" class="voice-btn" onclick="toggleVoiceInput()" title="Voice Input">üé§</button>
      <button id="speakBtn" class="voice-btn" onclick="toggleVoiceOutput()" title="Voice Output">üîä</button>
      <button onclick="send()">Send</button>
    </div>
  </div>

  <!-- Settings Modal -->
  <div id="settingsModal" class="settings-modal">
    <div class="settings-content">
      <h3>Voice Settings</h3>
      <label for="voiceSelect">Select Voice:</label>
      <select id="voiceSelect"></select>
      <label for="langSelect">Select Language:</label>
      <select id="langSelect">
        <option value="en-US">English (US)</option>
        <option value="en-GB">English (UK)</option>
        <option value="es-ES">Spanish</option>
        <option value="fr-FR">French</option>
        <option value="de-DE">German</option>
        <option value="it-IT">Italian</option>
        <option value="pt-BR">Portuguese (Brazil)</option>
        <option value="ja-JP">Japanese</option>
        <option value="ko-KR">Korean</option>
        <option value="zh-CN">Chinese (Mandarin)</option>
        <option value="ru-RU">Russian</option>
        <option value="ar-SA">Arabic</option>
        <option value="hi-IN">Hindi</option>
      </select>
      <button onclick="saveSettings()">Save</button>
      <button onclick="closeSettings()">Cancel</button>
    </div>
  </div>


  <script>
    function exitChat() {
      const confirmed = confirm("‚ö†Ô∏è Your progress will be lost if you exit!\n\nAre you sure you want to leave?");
      if (confirmed) {
        window.location.href = 'index.html';
      }
    }

    // Chat logic
    const chatEl = document.getElementById('chatContainer');
    const inputEl = document.getElementById('prompt');
    const micBtn = document.getElementById('micBtn');
    const speakBtn = document.getElementById('speakBtn');

    // Voice functionality
    let recognition;
    let isListening = false;
    let voiceOutputEnabled = false;
    const synth = window.speechSynthesis;
    let selectedVoice = null;
    let selectedLang = 'en-US';

    // Load saved settings
    selectedVoice = localStorage.getItem('selectedVoice');
    selectedLang = localStorage.getItem('selectedLang') || 'en-US';

    function populateVoices() {
      const voices = synth.getVoices();
      const voiceSelect = document.getElementById('voiceSelect');
      voiceSelect.innerHTML = '';
      voices.forEach((voice, index) => {
        const option = document.createElement('option');
        option.value = index;
        option.textContent = `${voice.name} (${voice.lang})`;
        if (selectedVoice && index == selectedVoice) {
          option.selected = true;
        }
        voiceSelect.appendChild(option);
      });
    }

    if (synth) {
      populateVoices();
      if (synth.onvoiceschanged !== undefined) {
        synth.onvoiceschanged = populateVoices;
      }
    }

    if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      recognition = new SpeechRecognition();
      recognition.continuous = false;
      recognition.interimResults = false;
      recognition.lang = selectedLang;

      recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        inputEl.value = transcript;
        send();
      };

      recognition.onend = () => {
        isListening = false;
        micBtn.classList.remove('active');
      };

      recognition.onerror = (event) => {
        console.error('Speech recognition error:', event.error);
        isListening = false;
        micBtn.classList.remove('active');
      };
    } else {
      micBtn.style.display = 'none';
    }

    function toggleVoiceInput() {
      if (!recognition) return;
      if (isListening) {
        recognition.stop();
      } else {
        recognition.start();
        isListening = true;
        micBtn.classList.add('active');
      }
    }

    function toggleVoiceOutput() {
      voiceOutputEnabled = !voiceOutputEnabled;
      speakBtn.classList.toggle('active');
    }

    function speakText(text) {
      if (!voiceOutputEnabled || !synth) return;
      const utterance = new SpeechSynthesisUtterance(text);
      if (selectedVoice) {
        const voices = synth.getVoices();
        const voiceIndex = parseInt(selectedVoice);
        if (voices[voiceIndex]) {
          utterance.voice = voices[voiceIndex];
        }
      }
      synth.speak(utterance);
    }

    function openSettings() {
      document.getElementById('settingsModal').style.display = 'flex';
      const langSelect = document.getElementById('langSelect');
      langSelect.value = selectedLang;
    }

    function closeSettings() {
      document.getElementById('settingsModal').style.display = 'none';
    }

    function saveSettings() {
      const voiceSelect = document.getElementById('voiceSelect');
      const langSelect = document.getElementById('langSelect');
      selectedVoice = voiceSelect.value;
      selectedLang = langSelect.value;
      localStorage.setItem('selectedVoice', selectedVoice);
      localStorage.setItem('selectedLang', selectedLang);
      if (recognition) {
        recognition.lang = selectedLang;
      }
      closeSettings();
      // Speak greeting in the new voice
      setTimeout(() => speakText("Hello, I am GitBot, Mark's AI"), 500);
    }

    // Google Custom Search API credentials (replace with your own)
    const GOOGLE_API_KEY = 'YOUR_GOOGLE_API_KEY'; // Get from Google Cloud Console
    const SEARCH_ENGINE_ID = 'YOUR_SEARCH_ENGINE_ID'; // Create a Custom Search Engine

    function appendMessage(role, text, imgUrl = null) {
      const msg = document.createElement('div');
      msg.className = 'message ' + role;
      const bubble = document.createElement('div');
      bubble.className = 'bubble';
      if (!imgUrl) {
        bubble.innerText = text;
      } else {
        bubble.style.display = 'none';
      }
      msg.appendChild(bubble);
      if (imgUrl) {
        const img = document.createElement('img');
        img.src = imgUrl;
        img.alt = text;
        msg.appendChild(img);
      }
      chatEl.appendChild(msg);
      chatEl.scrollTop = chatEl.scrollHeight;

      // Speak the message if voice output is enabled and it's a bot message
      if (role === 'bot') {
        if (imgUrl) {
          speakText(`Here's an image: ${text}`);
        } else {
          speakText(text);
        }
      }
    }

    function shouldGenerateImage(prompt) {
      const triggers = ['draw', 'generate image', 'show me', 'image of', 'picture', 'paint'];
      return triggers.some(kw => prompt.toLowerCase().includes(kw));
    }

    async function searchGoogle(prompt) {
      try {
        const url = `https://www.googleapis.com/customsearch/v1?key=${GOOGLE_API_KEY}&cx=${SEARCH_ENGINE_ID}&q=${encodeURIComponent(prompt)}`;
        const response = await fetch(url);
        if (!response.ok) {
          throw new Error('Search failed');
        }
        const data = await response.json();
        if (data.items && data.items.length > 0) {
          let formattedResults = `Search results for "${prompt}":\n\n`;
          data.items.slice(0, 5).forEach((item, index) => {
            formattedResults += `${index + 1}. **${item.title}**\n   ${item.snippet}\n   [Link](${item.link})\n\n`;
          });
          return formattedResults;
        } else {
          return `Sorry, I did not quite catch that`;
        }
      } catch (error) {
        console.error('Error searching Google:', error);
        return `Sorry, I did not quite catch that`;
      }
    }

    function simulateDallE(prompt) {
      const size = 400 + Math.floor(Math.random() * 100);
      return `https://placekitten.com/${size}/${size}`;
    }

    async function send() {
      const prompt = inputEl.value.trim();
      if (!prompt) return;
      appendMessage('user', prompt);
      inputEl.value = '';
      setTimeout(async () => {
        if (shouldGenerateImage(prompt)) {
          const imgUrl = simulateDallE(prompt);
          appendMessage('bot', prompt, imgUrl);
        } else {
          const reply = await searchGoogle(prompt);
          appendMessage('bot', reply);
        }
      }, 600);
    }

    inputEl.addEventListener('keydown', e => {
      if (e.key === 'Enter') send();
    });
  </script>

</body>
</html>